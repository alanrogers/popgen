\chapter{Mismatch Distribution and Spectrum}
\label{hw.mmspec}

Each exercise is worth 10 points.

\begin{exercise}
Describe in words the expected mismatch distribution of a population
that experienced a major episode of growth 8 units of mutational time
ago, but was otherwise constant in size. (Hint: a pair of gene copies
that has been separated for 8 units of mutational time will on average
differ by 8 mutations.) 
\begin{answer}
The mismatch distribution is likely to be unimodal, with a mode near
8.
\end{answer}
\end{exercise}

\begin{exercise}
  How should the unfolded site frequency spectrum of this expanded
  population differ from that of a population with a long history of
  constant size?
\begin{answer}
The expanded population should have an excess of sites in which the
derived allele is present in only one copy: an excess of singletons.
\end{answer}
\end{exercise}

Here is a set of 10 DNA sequences, each with 10 sites:
\begin{verbatim}
seq0      AAAATAAAAA
seq1      ....A....T
seq2      TTT.A...T.
seq3      .TT.AT...T
seq4      ...TA...T.
seq5      ...T.T.TTT
seq6      TT..A.....
seq7      ....A.....
seq8      .T..A.....
seq9      ......T.T.
\end{verbatim}
\begin{exercise}
Use these data to calculate a mismatch distribution. (Remember that the
first entry of the mismatch distribution is the number of pairs of
sequences that differ at 0 nucleotide sites.)
\begin{answer}
The mismatch distribution is
\begin{center}
\begin{tabular}{rr}
Differences & Pairs\\
\hline
0 & 0\\
1 & 4\\
2 & 7\\
3 & 10\\
4 & 9\\
5 & 8\\
6 & 3\\
7 & 2\\
8 & 2\\
\hline
\end{tabular}
\end{center}
\end{answer}
\end{exercise}

\begin{exercise}
To check your mismatch distribution, make sure that the sum of the
counts in the mismatch distribution is equal to the number of pairs of
individuals in the data, i.e.\ to $K(K-1)/2$, where $K$ is the number
of sequences.
\begin{answer}
The sum of the mismatch distribution is 45, which is also equal to
  $10\times 9 / 2$. 
\end{answer}
\end{exercise}

\begin{exercise}
As a second check, calculate $\pi$, the mean pairwise difference, from the
mismatch distribution as follows:
\[
\pi = \left(\frac{K(K-1)}{2}\right)^{-1} \sum_i i F_i  
\]
where $F_i$ is the number of pairs of sequences that differ by $i$ nucleotide
sites and $K$ is the number of sequences.
\begin{answer}
The mean pairwise difference is calculated from the mismatch
distribution as
\begin{eqnarray*}
\pi &=& \sum_i i F_i \bigg / \left(\frac{K(K-1)}{2}\right)\\
    &=& 172 / 45 = 3.82
\end{eqnarray*}
where $F_i$ is the number of pairs of sequences that differ by $i$ nucleotide
sites and $K$ is the number of sequences.
\end{answer}
\end{exercise}

\begin{exercise}
Calculate $\pi$ once again using the easy method described   
in my chapter on Descriptive Statistics for DNA Sequences.
Make sure that the two ways of calculating $\pi$ give the same answer.
\begin{answer}
\begin{eqnarray*}
\pi &=& 
\biggl(\overbrace{2\times 8}^{\hbox{\tiny site 0}}
+ \overbrace{4\times 6}^{\hbox{\tiny site 1}}
+ \overbrace{2\times 8}^{\hbox{\tiny site 2}}
+ \overbrace{2\times 8}^{\hbox{\tiny site 3}}
+ \overbrace{3\times 7}^{\hbox{\tiny site 4}}\\
&&\mbox{} 
+ \overbrace{2\times 8}^{\hbox{\tiny site 5}}
+ \overbrace{1\times 9}^{\hbox{\tiny site 6}}
+ \overbrace{1\times 9}^{\hbox{\tiny site 7}}
+ \overbrace{4\times 6}^{\hbox{\tiny site 8}}\\
&&\mbox{} 
+ \overbrace{3\times 7}^{\hbox{\tiny site 9}}\biggr) / 45
= 172/45 = 3.82
\end{eqnarray*}
\end{answer}
\end{exercise}

Tables~A and~B contain two additional sets of data, each with 20 sequences and
50 sites.  For your convenience, we have also given you the mismatch
distribution of each dataset.  The first entry in the mismatch distribution is
the number of pairs of sequences in the data that differ by 0 sites; the
second entry counts the pairs that differ by 1 site, and so on.

These data sets were generated by computer simulations.  For one data set, the
simulation assumed a history of constant population size.  For the other, the
simulation assumed that the population experienced an episode of sudden growth
but was constant in size before and after this episode.  For the expanded
population, the population history parameters were: $\theta_0 = 1$, $\theta_1
= 1000$, and $\tau=5$.  For the stationary population, there is only one
population history parameter: $\theta = 5.98$.

Your job is to figure out which data set came from which population.
\begin{exercise}
\label{it.plotA}
Plot the mismatch distribution of data set~A.  \textbf{Do not
calculate the distribution yourself.}  The numbers are
provided for you below the data set.
\begin{answer}
\begin{center}
\input{figmmA}
\end{center}
The vertical axis $(F_i)$ is the fraction of pairs of DNA sequences
that differ by the number of sites shown on the horizontal axis.
\end{answer}
\end{exercise}

\begin{exercise}
Repeat exercise~\ref{it.plotA} using data set~B.
\begin{answer}
\begin{center}
\input{figmmB}
\end{center}
The vertical axis $(F_i)$ is the fraction of pairs of DNA sequences
that differ by the number of sites shown on the horizontal axis.
\end{answer}
\end{exercise}

\begin{exercise}
Calculate the folded observed site-frequency spectrum of data set~A.
\begin{answer}
  For the 31 polymorphic sites, the frequencies of the ``minor
  allele'' (the rarer of the two at each site) are 2, 1, 1, 1, 1, 1,
  5, 1, 6, 1, 1, 6, 1, 1, 1, 3, 2, 1, 1, 1, 1, 1, 1, 1, 2, 1, 5, 3, 2,
  2, and 2. The folded observed spectrum is
  \begin{center}
    \begin{tabular}{rr}
      Minor  & \\
      allele & Observed\\
      count  & spectrum\\ \hline
      1 & 19\\
      2 & 6\\
      3 & 2\\
      4 & 0\\
      5 & 2\\
      6 & 2\\
      7 & 0\\
      8 & 0\\
      9 & 0\\
     10 & 0
    \end{tabular}
\end{center}  
\end{answer}
\end{exercise}

\begin{exercise}
Calculate the folded observed site-frequency spectrum of data set~B.
\begin{answer}
  For the 20 polymorphic sites, the frequencies of the ``minor
  allele'' (the rarer of the two at each site) are 2, 7, 2, 6, 2, 2,
  7, 7, 2, 5, 1, 1, 2, 1, 1, 7, 3, 1, 2, and 1.  The folded observed
  spectrum is
  \begin{center}
    \begin{tabular}{rr}
      Minor  & \\
      allele & Observed\\
      count  & spectrum\\ \hline
      1 & 6\\
      2 & 7\\
      3 & 1\\
      4 & 0\\
      5 & 1\\
      6 & 1\\
      7 & 4\\
      8 & 0\\
      9 & 0\\
      10 & 0
    \end{tabular}
  \end{center}  
\end{answer}
\end{exercise}

The next few exercises will ask you to calculate the folded spectrum
that is expected under the hypothesis of neutrality and constant
population size---the ``theoretical'' folded spectrum.  Here's how to
calculate the expected values: Let $s_i$ represent the $i$th entry of
the empirical spectrum in a sample of $K$ DNA sequences.  Its expected
value is 
\[
E[s_i] = \theta/i + \theta/(K-i)
\]
for positive integers $i$ that are less than $K/2$.

If the number of sequences is even, then the spectrum has an
additional term at which $i = K/2$. For that term,
\[
E[s_i] = \theta/i
\]
This issue arises with the present data sets, both of which have an
even number of sequences.

To calculate numerical values, replace $\theta$ in these expressions
with its estimate,
\[
\hat\theta_S = \frac{S}{\sum_{i=1}^{K-1} 1/i}
\]
where $S$ is the number of segregating sites.  In our two data sets,
$K=20$, so the sum in the denominator is $\sum_{i=1}^{19} 1/i =
3.5477$. We mention this merely to save you the trouble of calculating
it. With Python, however, the calculation is easy:
\verb@sum([1/i for i in range(1,20)])@.

\begin{exercise}
Calculate the folded theoretical site-frequency spectrum of
data set~A---the spectrum expected under selective neutrality and
constant population size. 
\begin{answer}
  To estimate $\theta$, note that $S=31$, so $\hat\theta =
  31/\sum_{i=1}^{K-1} 1/i = 8.73796$. The expected folded spectrum is
\begin{center}
\begin{tabular}{rr}
\multicolumn{2}{c}{Data set~A}\\
 Minor &\\
allele &Expected\\
 count &spectrum\\
 \hline
 1 & 9.19785\\
 2 & 4.85442\\
 3 & 3.42665\\
 4 & 2.73061\\
 5 & 2.33012\\
 6 & 2.08047\\
 7 & 1.92043\\
 8 & 1.82041\\
 9 & 1.76524\\
10 & 0.87380\\
\hline
\end{tabular}
\end{center}
\end{answer}
\end{exercise}

\begin{exercise}
  Calculate the folded theoretical site-frequency spectrum of data
  set~B---the spectrum expected under selective neutrality and
  constant population size.
\begin{answer}
  To estimate $\theta$, note that $S=20$, so $\hat\theta =
  20/\sum_{i=1}^{K-1} 1/i = 5.63739$. The expected folded spectrum is
  \begin{center}
\begin{tabular}{rr}
\multicolumn{2}{c}{Data set~B}\\
 Minor &\\
allele &Expected\\
 count &spectrum\\
 \hline
 1 & 5.93410\\
 2 & 3.13188\\
 3 & 2.21074\\
 4 & 1.76169\\
 5 & 1.50330\\
 6 & 1.34224\\
 7 & 1.23899\\
 8 & 1.17446\\
 9 & 1.13887\\
10 & 0.56374\\
\hline
\end{tabular}
\end{center}
\end{answer}
\end{exercise}

\begin{exercise}
Plot the observed and theoretical spectra for data set~A.
\begin{answer}
\begin{center}
\input{figspecA}
\end{center}
The graph shows the observed spectrum as open circles and the expected
one as a solid line.
\end{answer}
\end{exercise}

\begin{exercise}
Plot the observed and theoretical spectra for data set~B.
\begin{answer}
\begin{center}
\input{figspecB}
\end{center}
The graph shows the observed spectrum as open circles and the expected
one as a solid line.
\end{answer}
\end{exercise}

\begin{exercise}
Use these results to figure out which data set came from an expanded
population and which came from a stationary population.
\begin{answer}
Data set~A came from an expanded population, and data set~B from a
stationary one.
\end{answer}
\end{exercise}

\begin{table}
\caption{Polymorphic Sites from Data Set A\label{tab.A}}
\begin{verbatim}
%         0123456789 0123456789 0123456789 0
seq0      TAAAAATATA ATAAAAAATA AAAAAAAAAA A
seq1      A.T....... ........A. ......T... .
seq2      A...T..... ...T....A. ......T... .
seq3      A......... .....T.TA. ......T... .
seq4      A.....AT.. ........A. ......TTT. .
seq5      A.....A... .A......A. .T....TT.. .
seq6      AT........ ........A. ......T..T .
seq7      A.....A... ........A. ....T.T... .
seq8      A.....A.A. ........A. ......T... .
seq9      A.....A... ....T...A. .....TT... .
seq10     A.....A... ........A. T.....T... T
seq11     ...T..A... ..T...T.A. ..T...T... .
seq12     A.....A... ........A. ......T... .
seq13     A.....A... ........A. ......T... .
seq14     A.....A... ........A. ......T..T T
seq15     A.....A.A. .A......AT .......T.. .
seq16     A.....A.AT TA......A. ......T... .
seq17     A.....A.A. .A...TT.A. ...TT...T. .
seq18     A.....A.A. .A...T..A. .......... .
seq19     A....TA.A. .A......A. .......... .
\end{verbatim}
In addition to the 31 polymorphic sites, there are 19 fixed sites.

Mismatch dist: 1   4  11  27  33  33  28  26  12   6   6   3
\end{table}

\begin{table}
\caption{Polymorphic Sites from Data Set B\label{tab.B}}
\begin{verbatim}
%         0123456789 0123456789
seq0      ATAAAATAAA TAAAATAAAA
seq1      .......... A.........
seq2      .......... A.........
seq3      .......... A.........
seq4      .......... AT..T.....
seq5      T.T.TT..TT A.T.....T.
seq6      T.T.TT..TT A.T.....T.
seq7      .A....AT.T A....A....
seq8      .A....AT.T A....A....
seq9      .A....AT.T A....A....
seq10     .A....AT.T A....A....
seq11     .A....AT.T A....A....
seq12     .A....AT.T A....A....
seq13     .A....AT.T A..T.A.T.T
seq14     .A.T.....T A....A....
seq15     .A.T.....T A....A....
seq16     .A.T.....T A....A....
seq17     .A.T.....T A....AT...
seq18     .A.T.....T A....AT...
seq19     .A.T.....T A....AT...
\end{verbatim}
In addition to the 20 polymorphic sites, there are 30 fixed sites.

Mismatch dist: 25  12   3  25  27  30  15  12   9   
3   9  18   0   0   2
\end{table}

%\item Calculate Tajima's D for each data set.
%\sum_{i=1}^{19} 1/i^2 &=& 1.5937\\

