% -*-latex-*-
%\documentclass[handout]{beamer} 
\documentclass[]{beamer} 
\usepackage{etex}
\usepackage{alltt}

\let\latexput\put
\usepackage{pictex}
\let\pictexput\put
\let\put\latexput

\newcommand{\G}{\mathcal{G}}
\newcommand{\Het}{\mathcal{H}}
\newcommand{\mutation}{$\cdot$} 
\newcommand{\OR}{\;\hbox{or}\;}
\newcommand{\AND}{\;\&\;}
\newdimen\offsety
\newdimen\yunit
\newdimen\xunit
\newdimen\thusfar
\newdimen\plotht
\newdimen\plotwd
\newdimen\plotsp
\title{Gene Genealogies}
\author{Alan R. Rogers}
\date{\today}
\begin{document}

\title{Gene Genealogies}
\author{Alan R. Rogers}
\date{\today}
\frame{\titlepage}

\begin{frame}
\begin{columns}
\column{0.57\textwidth}
\input{figgro}
\column{0.43\textwidth}
Gene genealogy: ancestry of a sample of gene copies.

\bigskip

Coalescent event: when lines of descent coalesce at common ancestors.

\bigskip

Shape reflects history of population size.

\bigskip

Coalescent theory connects history to genetics via gene genealogy.
\end{columns}
\end{frame}

\begin{frame}
  \frametitle{Hazards}

  The \emph{hazard} of an event at time $t$ is the conditional
  rate at which it occurs then, given that it did not occur
  earlier.

  \bigskip

  We'll be interested in the hazards of coalescent events in reverse
  time: looking backwards from the present.
\end{frame}  

\begin{frame}
\frametitle{Preliminaries: 2 mathematical tricks}

\begin{enumerate}
\item If the hazard of a coalescent event is $h$ per generation, then
  we wait on average $1/h$ generations until the event happens.
\item There are $k(k-1)/2$ ways to choose 2 items out of $k$.
\end{enumerate}
See \emph{Lecture Notes on Gene Genealogies} (available online) for details.
\end{frame}

\begin{frame}[containsverbatim]
\frametitle{Coalescence time in a sample of two gene copies}
\begin{columns}
\column{0.67\textwidth}
\begin{verbatim}
   X -----------------------|
                            A------
   Y -----------------------|
    
   |--------- t ------------|

\end{verbatim}
\column{0.33\textwidth}
$X$ and $Y$ live now; ancestor $A$ lived $t$ generations ago.
\end{columns}

\bigskip

How can we calculate $E[t]$---the expected ``coalescence time?''
\end{frame}

\begin{frame}[containsverbatim]
\frametitle{Coalescent probability per generation in a sample of 2 gene copies}
\begin{alltt}
              ________Population__________
Parents       0  Z  0  0  0  0  0  0  0  0
                 |
Offspring     0  X  0  Y  0  0  0  0  0  0
\end{alltt}

\medskip A population comprising 10 gene copies ($2N=10$).
Offspring generated by sampling with replacement from parents.

\medskip

$Z$ is the parent of $X$. What is the probability that $Y$ has the
same parent?
\[
1/10 \qquad\hbox{or}\qquad 1/2N
\]
\medskip
$1/2N$ is the probability of a coalescent event in a sample of 2 gene
copies.
\end{frame}

\begin{frame}
  \frametitle{Treating time as a continuum}

  So far, we've treated time in discrete units of 1 generation.

  \medskip

  In continuous time, let $h_2$ represent the hazard of a coalescent
  event in a sample of 2 gene copies. This means that $h_2 \delta$ is
  $\approx$ the probability of an event during a small interval of
  length $\delta$.

  \medskip

  If $2N$ is large, then there will be little change in 1 generation,
  and we can consider this interval to be ``small.'' Let us therefore
  set $\delta=1$.

  \medskip

  Then $h_2 = 1/2N$ is the hazard per generation of a coalescent event
  in a sample of 2 gene copies.
\end{frame}

\begin{frame}
\frametitle{Expected coalescence time in a sample of 2 gene copies}

We just saw that the hazard of a coalescent event is $h = 1/2N$ per
generation.

\bigskip

Recall that if the hazard is $h_2$, the expected waiting time is
$E[t_2] = 1/h_2$.

\bigskip

The expected coalescence time in a sample of 2 gene copies is
\[
E[t_2] = 2N
\]
generations.

\pause
\bigskip
Example: if $N=10,000$, $E[t_2] = 20,000$ generations, or about 60,000
human years.
\end{frame}

\begin{frame}[containsverbatim]
\frametitle{Coalescent hazard in a sample of $K$}
\begin{verbatim}
   W --------|                               
             |------------|                  
   X --------|            |                  
                          |--------------|   
   Y ---------------------|              |---
                                         |   
   Z ------------------------------------|   
   
   |-- t_4 --|---- t_3 ---|------ t_2 ---|
\end{verbatim}

\medskip With 4 gene copies, there are 3 coalescent intervals: $t_4$,
$t_3$, and $t_2$.

\medskip

The intervals are independent, so we can consider them one at a
time.
\end{frame}

\begin{frame}
\frametitle{Expected length of a coalescent interval containing 3
  lines of descent}

With 3 lines of descent ($X$, $Y$, and $Z$), there are 3 pairs of
lines ($XY$, $XZ$, and $YZ$).

\pause
\medskip

For each pair, we already know the coalescent hazard: $h_2 = 1/2N$.

\pause
\medskip

We have 3 pairs, so the coalescent hazard is 3$\times$ as large:
$h_3=3/2N$. (This argument is loose, but the answer is correct.)

\pause
\medskip

Expected length of an interval with 3 lines of descent:
\[
E[t_3] = 1/h_3 = 2N/3
\]
\end{frame}

\begin{frame}
\frametitle{Expected length of a coalescent interval containing $i$
  lines of descent}

With $i$ lines of descent, there are $i(i-1)/2$ pairs of
lines. (See mathematical trick~2 above.)

\pause
\medskip

Coalescent hazard of each pair: $h_2 = 1/2N$.

\pause
\medskip

Hazard within an interval with $i$ lines of descent:
\[
h_i = \frac{i(i-1)}{4N}
\]

\pause
\medskip

Expected length of an interval with $i$ lines of descent:
\[
E[t_i] = 1/h_i = \frac{4N}{i(i-1)}
\]
\end{frame}

\begin{frame}
\frametitle{Coalescent intervals in a sample of size 4}
\def\mystrut{\rule{0pt}{1.2em}}
{\centering
\begin{tabular}{ccc}
         & Coalescent & Expected\\
Interval & hazard     & length\\ \hline
4 & $h_4 = \displaystyle \frac{\mystrut 4 \times 3}{4N} = 6/2N$  & $2N/6$\\
3 & $h_3 = \displaystyle \frac{\mystrut 3 \times 2}{4N} = 3/2N$  & $2N/3$\\
2 & $h_2 = \displaystyle \frac{\mystrut 2 \times 1}{4N} = 1/2N$  & $2N$\\[7pt] 
\hline
\end{tabular}\\}
\end{frame}

\begin{frame}
\frametitle{Expected depth of a gene genealogy}

``Depth'' is the expected time (generations) since the last common
ancestor (LCA).
\begin{center}
\begin{tabular}{cr@{$\;=\;$}l}
Sample & \multicolumn{2}{c}{Mean depth} \\
size   & \multicolumn{2}{c}{of tree} \\ \hline
2 & $1/h_2$ & $2N$\\ 
3 & $1/h_3 + 1/h_2$ & $8N/3$\\
4 & $1/h_4 + 1/h_3 + 1/h_2$ & $3N$\\
5 & $1/h_5 + 1/h_4 + 1/h_3  + 1/h_2$ & $16N/5$\\ \hline
\end{tabular}
\end{center}
In general, mean depth is
\[
4N(1 - 1/K)
\]
where $K$ is the number of gene copies in the sample.
\end{frame}

\begin{frame}
  \frametitle{Deriving the formula}
  $E[t_i] = \frac{4N}{i(i-1)}$, so expected depth is
    \[
    4N\sum_{i=2}^K 1/i(i-1)
    \]
To simplify this sum, convince yourself that
\[
\frac{1}{i(i-1)} = \frac{1}{i-1} - \frac{1}{i}
\]
Then substitute the right side into the sum above and write the sum
out in expanded form. You should end up with $4N(1 - 1/K)$.
\end{frame}  

\begin{frame}
  \frametitle{A simulated genealogy of 50 gene copies}
             {\centering\input{figeq}\\}

             \bigskip 

             Recent coalescent intervals are short; ancient ones are long.

             \bigskip 

             The larger the sample, the shorter will be recent intervals.

             \bigskip 

             Large samples don't help much, because few mutations
             appear on these short intervals.
\end{frame}

\begin{frame}
  \frametitle{Review}
  \begin{itemize}
    \item What is a coalescent event?
    \item What is a hazard?
    \item What is the hazard of a coalescent event in an interval with
      $i$ lines of descent?
    \item What is the expected length of such an interval?
    \item What is the expected depth of a gene genealogy with $K$
      tips?
    \item Why are coalescent intervals longer in large populations?
    \item Why are they shorter in large samples?
  \end{itemize}
\end{frame}

\title{Relating Gene Genealogies to Genetics}
\author{Alan R. Rogers}
\date{\today}
\frame{\titlepage}

\begin{frame}
Gene genealogies are not observable: we can never know the true
genealogy of a sample. To \emph{estimate}, we need a theory that
relates gene genealogies to observable genetic data.

This lecture will:
\begin{enumerate}
\item add mutations to gene genealogies,
\item derive theory for the number, $S$, of segregating sites, and
\item the mean pairwise difference, $\pi$, between sequences.  
\end{enumerate}
\end{frame}

\begin{frame}[containsverbatim]
  \frametitle{A genealogy with 8 (not 9) mutations}
  \begin{columns}
    \column{0.65\textwidth}
\begin{verbatim}

     --x----x---
                |
                |------x-
                |        |
     ------xx---         |
                         |-----x----
                         |
                         |
     ---x-x----------x---

     |---t -----|---t ---|
          3          2
\end{verbatim}
\column{0.35\textwidth}
\raggedleft
We are interested in mutations downstream of the root, because
only these contribute to variation.
\end{columns}
\end{frame}

\begin{frame}[containsverbatim]
  \frametitle{Expected \# of mutations in a sample of size 3}
  \begin{columns}
    \column{0.65\textwidth}
\begin{verbatim}

   --x----x---
              |
              |------x-
              |        |
   ------xx---         |
                       |--------
                       |
                       |
   ---x-x----------x---

   |---t -----|---t ---|
        3          2
\end{verbatim}
\column{0.35\textwidth}
\raggedleft
\[
E[\# mutations|L] = uL
\]
where $u$ is mutation rate and $L$ is total branch length.

\bigskip

\[
L = 3t_3 + 2t_2
\]

\bigskip

Unconditionally, $E[\# mutations] = E[uL] = u E[L]$.
\end{columns}
\end{frame}

\begin{frame}
\frametitle{For a tree with 3 tips}

\[
L = 3t_3 + 2t_2
\]

\bigskip

Recall that $E[t_i] = 4N/i(i-1)$. \pause Therefore,
\begin{eqnarray*}
  E[L] &=& 3E[t_3] + 2E[t_2]\\
  &=& (3 \times 2N/3) + (2 \times 2N)\\
  &=& 6N
\end{eqnarray*}  

\bigskip\pause

Expected number of mutations is $6Nu$ for a tree with 3 tips.
\end{frame}

\begin{frame}
\frametitle{Expected length of tree with $K$ tips}
Expected length of the coalescent interval w/
$i$ lines of descent
\[
E[t_i] = \frac{4N}{i(i-1)}
\]
\pause
Contribution to $E[L]$:
\[
iE[t_i] = \frac{4N}{i-1}
\]
\pause
Total expected length:
\[
E[L] = \sum_{i=2}^K iE[t_i] = 4N \sum_{i=1}^{K-1} \frac{1}{i}
\]
\end{frame}

\begin{frame}
\frametitle{The expected number of mutations}
\begin{eqnarray*}
  E[\hbox{\# of mutations}] &=& u E[L]\\
  &=& 4Nu \sum_{i=1}^{K-1} \frac{1}{i}\\
  &=& \theta \sum_{i=1}^{K-1} \frac{1}{i}\\
  &=& \theta \left\{1 + \frac{1}{2} + \frac{1}{3} + \cdots +
  \frac{1}{K-1}\right\}
\end{eqnarray*}
\end{frame}

\begin{frame}
  \frametitle{Mutation: the model of infinite sites}
  Mutation never strikes the same site twice, so the number of
  nucleotide differences between two sequences equals the number of
  mutations that separate them.

  \bigskip

  This is an approximation that works well with intraspecific data
  sets, because the mutation rate is so low that few sites mutate more
  than once.
\end{frame}

\begin{frame}
  \frametitle{The expected number, $S$, of segregating sites}
  $S$ is the number of segregating (i.e.\ polymorphic) sites in a set
  of sequence data.

  \bigskip

  Under infinite sites, its expectation equals the expected number of
  mutations on the tree:
\[
E[S] = \theta \left\{1 + \frac{1}{2} + \frac{1}{3} + \cdots +
  \frac{1}{K-1}\right\}
\]
\end{frame}

\begin{frame}
  \frametitle{The effect of sample size is modest}
\begin{center}
\begin{tabular}{rr}
$K$ & $\sum_{i=1}^{K-1} 1/i$\\ \hline
2 & 1.00\\
3 & 1.50\\
5 & 2.08\\
10 & 2.82\\
100 & 5.17\\
1000 & 7.48\\
\hline
\end{tabular}
\end{center}

\bigskip

For practical purposes, $E[S]$ is $\theta$ times a number between 2
and 5.
\end{frame}

\begin{frame}
  \frametitle{The mean pairwise difference, $\pi$}

  The mean pairwise difference, $\pi$, is the mean number of
  nucleotide site differences between pairs of sequences in a sample.

  \bigskip

  In other words, it is the number of segregating sites in a sample of
  size 2.

  \bigskip

  Using our formula for $E[S]$,
\[
E[\pi] = \theta \sum_{i=1}^{1} \frac{1}{i} = \theta
\]
\end{frame}

\begin{frame}
  \frametitle{Two ways to estimate $\theta$}
\begin{eqnarray*}
\hat\theta_S &=& \frac{S}{\sum_{i=1}^{K-1} \frac{1}{i}}\\
\hat\theta_{\pi} &=& \pi
\end{eqnarray*}
Here $\hat\theta$ is read ``theta hat.''  The ``hat'' indicates that
these formulas are intended to estimate the parameter $\theta$.

\bigskip\pause

Since these formulas estimate the same parameter, we might expect them
to be similar in real data. Are they?
\end{frame}  

\begin{frame}
  \frametitle{Discrepancy between $\hat\theta_S$ and
    $\pi$}

Mitochondrial sequence data published by Lynn Jorde's lab, describing
77 Asians and 72 Africans:
\begin{center}
\begin{tabular}{lcc}
                            & Asian & African \\ \hline
$S$                         &  82    &   63\\
$\sum_{i=1}^{K-1} 1/i$      & 4.915  & 4.847\\
$\hat\theta_S$ (per sequence) & 16.685 & 12.998\\
$\pi$ (per sequence)        & 6.231  & 9.208\\
\hline
\end{tabular}
\end{center}

\bigskip

Contrary to expectation, $\theta_S$ is much larger than $\pi$. Why?

\end{frame}

\begin{frame}[containsverbatim]
  \frametitle{Thinking about this discrepancy}
  
  $S$ is equally sensitive to mutations anywhere in the gene genealogy.

  $\pi$, the MPD, is less sensitive to singletons than to mutations of
  intermediate frequency. 

\begin{verbatim}
   00000 00001
   12345 67890
S1 AAACT GTCAT
S2 ..... A....
S3 ..... A...C
S4 ..G.. A....
S5 ..G.. A....
S6 ..G.. A....
     ^   ^
     |   |
     |    ------ Contributes 1 X 5 = 5 pairwise diffs
      ---------- Contributes 3 X 3 = 9 pairwise diffs
\end{verbatim}
\end{frame}

\begin{frame}
  \frametitle{What does this imply about Jorde's data?}

  In the data, $\hat\theta_S \gg \pi$.

  \bigskip

  Suggests there are many young mutations (near the tips of the gene
  genealogy), where they affect $\hat\theta_S$ more than $\pi$.

  \bigskip

  As we'll learn later in the course, this implies a history of
  population growth.
\end{frame}  

\end{document}


